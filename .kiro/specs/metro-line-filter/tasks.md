# Implementation Plan

- [x] 1. 레이어 관리 구조 리팩토링

  - MetroMapContainer에서 Polyline과 Marker를 노선별 레이어 그룹으로 분리하여 관리
  - 각 노선별로 `L.LayerGroup`을 생성하고 ref로 관리
  - 기존의 직접 map에 추가하는 방식을 레이어 그룹에 추가하는 방식으로 변경
  - _Requirements: 1.1, 1.2_

- [x] 2. 노선 필터링 로직 구현

- [x] 2.1 필터링 함수 작성

  - `applyLineFilter` 함수를 구현하여 선택된 노선의 레이어만 표시
  - 선택된 노선이 없으면 모든 레이어 표시
  - 레이어 가시성 제어 로직 구현 (`addTo` / `removeLayer`)
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 2.2 환승역 특별 처리

  - 환승역 마커를 별도로 관리하거나 필터링 로직에서 특별 처리
  - 선택된 노선에 속한 환승역은 항상 표시되도록 구현
  - 환승역의 모든 노선 정보가 팝업에 표시되는지 확인
  - _Requirements: 2.1, 2.2, 2.3_

- [x] 2.3 useEffect로 필터링 자동 적용

  - `selectedLine` 상태 변경 시 `applyLineFilter` 함수 자동 호출
  - 의존성 배열에 `selectedLine` 추가
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 3. UI 업데이트 및 토글 기능
- [ ] 3.1 노선 버튼 토글 동작 구현

  - 노선 버튼 클릭 시 같은 노선이면 필터 해제, 다른 노선이면 필터 적용
  - `highlightLine` 함수에 토글 로직 추가
  - _Requirements: 3.1, 3.2_

- [ ] 3.2 선택된 노선 시각적 표시

  - 선택된 노선 버튼의 배경색과 텍스트 색상 변경
  - 선택된 노선 이름을 화면에 표시 (선택사항: 지도 상단에 "X호선 필터링 중" 텍스트)
  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 3.3 전체 보기 버튼 연동

  - 전체 보기 버튼 클릭 시 `selectedLine`을 null로 설정하여 필터 해제
  - `resetView` 함수에 `setSelectedLine(null)` 추가
  - _Requirements: 3.3_

- [ ] 4. 경로 탐색 필터링 통합
- [ ] 4.1 그래프 빌드 함수 수정

  - `buildGraph` 함수에 `selectedLine` 매개변수 추가
  - 선택된 노선이 있으면 해당 노선의 edge만 사용하여 그래프 빌드
  - 환승 edge는 항상 포함 (line에 '-'가 포함된 경우)
  - _Requirements: 5.1, 5.3_

- [ ] 4.2 경로 탐색 실패 처리

  - 필터링된 노선으로 경로를 찾지 못한 경우 사용자에게 안내 메시지 표시
  - "선택된 노선으로는 경로를 찾을 수 없습니다" 메시지 구현
  - _Requirements: 5.2_

- [ ] 4.3 경로 탐색 함수에 필터 적용

  - `dijkstraWithTransfers` 함수 호출 시 `selectedLine` 전달
  - 필터링된 그래프로 경로 탐색 수행
  - _Requirements: 5.1, 5.3_

- [ ] 5. 에러 처리 및 방어 코드

  - 잘못된 노선 ID 입력 시 경고 로그 출력 및 무시
  - 레이어 작업 중 에러 발생 시 catch하고 전체 보기로 복구
  - try-catch 블록으로 필터링 로직 감싸기
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ]\* 6. 테스트 작성
- [ ]\* 6.1 필터링 로직 단위 테스트

  - 특정 노선 선택 시 해당 노선의 역만 반환되는지 테스트
  - 환승역이 올바르게 포함되는지 테스트
  - 필터 해제 시 모든 역이 반환되는지 테스트
  - _Requirements: 1.1, 2.1_

- [ ]\* 6.2 컴포넌트 통합 테스트
  - 노선 버튼 클릭 시 상태 업데이트 테스트
  - 토글 동작 테스트
  - 전체 보기 버튼 동작 테스트
  - _Requirements: 3.1, 3.3, 4.1_
